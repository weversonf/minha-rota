<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>Minha Rota</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
    <style>
        :root { --cor-principal: #e74c3c; --cor-fundo: #121212; }
        body { margin: 0; padding: 0; background: var(--cor-fundo); font-family: 'Segoe UI', Roboto, sans-serif; overflow: hidden; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; display: none; }
        
        /* Tela de Login */
        #login-screen { 
            position: fixed; width: 100%; height: 100%; background: var(--cor-fundo); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 100;
        }
        .login-card { width: 85%; max-width: 400px; text-align: center; }
        input { 
            padding: 18px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; 
            width: 100%; background: #1e1e1e; color: white; text-align: center; font-size: 18px; box-sizing: border-box;
        }
        button { 
            padding: 18px; background: var(--cor-principal); color: white; border: none; 
            border-radius: 12px; font-weight: bold; width: 100%; font-size: 16px; cursor: pointer;
        }

        /* Card de Informações Inferior */
        #info-card {
            position: fixed; bottom: 25px; left: 5%; width: 90%; background: rgba(255,255,255,0.98); 
            padding: 20px; border-radius: 20px; display: none; z-index: 50; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .valor-gasto { color: #27ae60; font-size: 22px; font-weight: bold; margin-top: 5px; }
        .detalhe-rota { color: #555; font-size: 14px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <h1 style="margin-bottom: 5px;">Minha Rota</h1>
        <p style="color: #888; margin-bottom: 30px;">Segurança e Economia</p>
        <input type="password" id="group-key" placeholder="Chave do Grupo" autocomplete="off">
        <button onclick="checkKey()">ACESSAR MAPA</button>
    </div>
</div>

<div id="map"></div>

<div id="info-card">
    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
            <div id="rota-distancia" style="font-weight: bold; color: #333;">Calculando trajeto...</div>
            <div id="info-veiculo" class="detalhe-rota">FZ25 2023 (29km/L)</div>
        </div>
        <button onclick="this.parentElement.parentElement.style.display='none'" style="width: auto; padding: 5px 10px; background: #ddd; color: #333; font-size: 12px; border-radius: 5px; border: none;">X</button>
    </div>
    <div class="valor-gasto" id="gasto-estimado">R$ 0,00</div>
    <div style="font-size: 11px; color: #999; margin-top: 8px;">*Estimativa baseada no consumo médio</div>
</div>

<script>
    const CONFIG = {
        token: 'pk.eyJ1Ijoid2V2ZXJzb25mIiwiYSI6ImNtbHF5bmh1YTA0djgzZHB4dTJpaG9rbHgifQ.jo3DG631F030AxG_nFKVEQ',
        chaveAcesso: 'FZ25-FOR',
        veiculo: { consumo: 29 }, 
        precoCombustivel: 6.15, 
        centroInicial: [-38.5267, -3.7319] 
    };

    // Estrutura para você popular com pontos de Fortaleza
    const bancoDados = {
        areasRisco: [
            {
                nome: "Área Exemplo",
                coords: [
                    [-38.540, -3.720], [-38.525, -3.720],
                    [-38.525, -3.730], [-38.540, -3.730]
                ]
            }
        ],
        pontosApoio: [
            { nome: "Posto Shell 24h", coords: [-38.4891, -3.7327], desc: "Conveniência e Seguro" }
        ]
    };

    function checkKey() {
        const inputKey = document.getElementById('group-key').value;
        if(inputKey === CONFIG.chaveAcesso) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('map').style.display = 'block';
            initMap();
        } else {
            alert('Chave incorreta.');
        }
    }

    function initMap() {
        mapboxgl.accessToken = CONFIG.token;
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: CONFIG.centroInicial,
            zoom: 13
        });

        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: { enableHighAccuracy: true },
            trackUserLocation: true,
            showUserHeading: true
        }));

        map.on('load', () => {
            // Renderiza Áreas de Risco
            bancoDados.areasRisco.forEach((area, i) => {
                map.addSource(`risco-${i}`, {
                    'type': 'geojson',
                    'data': {
                        'type': 'Feature',
                        'geometry': { 'type': 'Polygon', 'coordinates': [area.coords] }
                    }
                });
                map.addLayer({
                    'id': `layer-${i}`,
                    'type': 'fill',
                    'source': `risco-${i}`,
                    'paint': { 'fill-color': '#ff0000', 'fill-opacity': 0.35 }
                });
            });

            // Renderiza Pontos de Apoio
            bancoDados.pontosApoio.forEach(ponto => {
                new mapboxgl.Marker({ color: '#3498db' })
                    .setLngLat(ponto.coords)
                    .setPopup(new mapboxgl.Popup().setHTML(`<b>${ponto.nome}</b><br>${ponto.desc}`))
                    .addTo(map);
            });
        });

        // Clique para simular cálculo de gasto
        map.on('click', (e) => {
            document.getElementById('info-card').style.display = 'block';
            const distKm = (Math.random() * 10 + 1).toFixed(1);
            const custo = (distKm / CONFIG.veiculo.consumo) * CONFIG.precoCombustivel;

            document.getElementById('rota-distancia').innerText = `Distância aprox: ${distKm} km`;
            document.getElementById('gasto-estimado').innerText = `R$ ${custo.toFixed(2)}`;
        });
    }
</script>
</body>
</html>
